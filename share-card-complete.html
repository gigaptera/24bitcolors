<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚®ãƒ£ãƒ©ãƒªãƒ¼é¢¨ã‚·ã‚§ã‚¢ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    h1 {
      font-size: 24px;
      font-weight: 700;
      color: #2C2C2C;
      margin-bottom: 30px;
      text-align: center;
    }

    .color-input-group {
      margin-bottom: 25px;
    }

    label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #555;
      margin-bottom: 8px;
    }

    input[type="color"] {
      width: 100%;
      height: 60px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    input[type="text"] {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      font-family: 'SF Mono', 'Courier New', monospace;
      transition: border-color 0.2s;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
    }

    .generate-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 20px;
    }

    .generate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .generate-btn:active {
      transform: translateY(0);
    }

    .preview-container {
      margin-top: 40px;
      display: none;
    }

    .preview-container.active {
      display: block;
    }

    .preview-title {
      font-size: 18px;
      font-weight: 600;
      color: #2C2C2C;
      margin-bottom: 15px;
      text-align: center;
    }

    #sharePreview {
      width: 100%;
      max-width: 300px;
      height: auto;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
      display: block;
      margin: 0 auto 20px;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .action-btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .download-btn {
      background: #34d399;
      color: white;
    }

    .download-btn:hover {
      background: #10b981;
    }

    .share-btn {
      background: #60a5fa;
      color: white;
    }

    .share-btn:hover {
      background: #3b82f6;
    }

    .info-text {
      text-align: center;
      font-size: 13px;
      color: #888;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¨ ã‚®ãƒ£ãƒ©ãƒªãƒ¼é¢¨ã‚·ã‚§ã‚¢ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ</h1>

    <div class="color-input-group">
      <label for="colorPicker">å¥½ããªè‰²ã‚’é¸æŠ</label>
      <input type="color" id="colorPicker" value="#bd6084">
    </div>

    <div class="color-input-group">
      <label for="hexInput">HEXã‚³ãƒ¼ãƒ‰</label>
      <input type="text" id="hexInput" value="#bd6084" maxlength="7">
    </div>

    <button class="generate-btn" onclick="generateCard()">
      âœ¨ ã‚·ã‚§ã‚¢ç”»åƒã‚’ç”Ÿæˆ
    </button>

    <div class="preview-container" id="previewContainer">
      <p class="preview-title">ğŸ“± ç”Ÿæˆã•ã‚ŒãŸã‚·ã‚§ã‚¢ç”»åƒ</p>
      <img id="sharePreview" alt="Share Card">
      
      <div class="action-buttons">
        <button class="action-btn download-btn" onclick="downloadCard()">
          ğŸ’¾ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        </button>
        <button class="action-btn share-btn" onclick="shareCard()">
          ğŸ“¤ ã‚·ã‚§ã‚¢
        </button>
      </div>

      <p class="info-text">Instagram Story ã‚µã‚¤ã‚º (1080 x 1920)</p>
    </div>
  </div>

  <script>
    /**
     * ã‚®ãƒ£ãƒ©ãƒªãƒ¼é¢¨ã‚·ã‚§ã‚¢ã‚«ãƒ¼ãƒ‰ç”Ÿæˆé–¢æ•°
     */
    function generateGalleryShareCard(colorHex, oklchData = null) {
      const canvas = document.createElement('canvas');
      canvas.width = 1080;
      canvas.height = 1920;
      const ctx = canvas.getContext('2d');

      // èƒŒæ™¯
      ctx.fillStyle = '#E8E8E8';
      ctx.fillRect(0, 0, 1080, 1920);

      // ã‚¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯é…ç½®
      const artX = 180;
      const artY = 480;
      const artWidth = 720;
      const artHeight = 480;

      // ã‚·ãƒ£ãƒ‰ã‚¦
      ctx.shadowColor = 'rgba(0, 0, 0, 0.12)';
      ctx.shadowBlur = 35;
      ctx.shadowOffsetX = 0;
      ctx.shadowOffsetY = 12;

      // é»’ãƒ•ãƒ¬ãƒ¼ãƒ 
      const frameThickness = 8;
      ctx.fillStyle = '#000000';
      ctx.fillRect(
        artX - frameThickness,
        artY - frameThickness,
        artWidth + frameThickness * 2,
        artHeight + frameThickness * 2
      );

      // è‰²ã®é•·æ–¹å½¢
      ctx.fillStyle = colorHex;
      ctx.fillRect(artX, artY, artWidth, artHeight);

      ctx.shadowColor = 'transparent';
      ctx.shadowBlur = 0;

      // ãƒŸãƒ¥ãƒ¼ã‚¸ã‚¢ãƒ ãƒ©ãƒ™ãƒ«
      const labelX = artX;
      const labelBaseY = artY + artHeight + 100;

      // "Your Color"
      ctx.fillStyle = '#2C2C2C';
      ctx.font = '500 52px Georgia, "Times New Roman", serif';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'top';
      ctx.fillText('Your Color', labelX, labelBaseY);

      // HEXã‚³ãƒ¼ãƒ‰
      ctx.font = '400 46px "SF Mono", "Courier New", Courier, monospace';
      ctx.fillStyle = '#000000';
      ctx.fillText(colorHex.toUpperCase(), labelX, labelBaseY + 70);

      // "24bitColors, 2025"
      ctx.font = '300 36px Georgia, serif';
      ctx.fillStyle = '#666666';
      ctx.fillText('24bitColors, 2025', labelX, labelBaseY + 135);

      // OKLCHå€¤ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
      if (oklchData) {
        ctx.font = '300 30px "SF Mono", monospace';
        ctx.fillStyle = '#999999';
        const oklchText = `L:${Math.round(oklchData.l * 100)}  C:${Math.round(oklchData.c * 100)}  H:${Math.round(oklchData.h)}Â°`;
        ctx.fillText(oklchText, labelX, labelBaseY + 190);
      }

      return canvas.toDataURL('image/png');
    }

    /**
     * ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
     */
    function downloadImage(dataURL, filename = 'my-color-2025.png') {
      const link = document.createElement('a');
      link.href = dataURL;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    /**
     * Web Share API
     */
    async function shareImageToSocial(dataURL, hex) {
      try {
        const response = await fetch(dataURL);
        const blob = await response.blob();
        const file = new File([blob], 'my-color.png', { type: 'image/png' });

        if (navigator.share && navigator.canShare({ files: [file] })) {
          await navigator.share({
            files: [file],
            title: 'My Favorite Color',
            text: `ç§ã®å¥½ããªè‰²ã¯ ${hex} ã§ã™! #24bitColors #YourColor`
          });
        } else {
          alert('ã“ã®ç«¯æœ«ã§ã¯ã‚·ã‚§ã‚¢æ©Ÿèƒ½ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
          downloadImage(dataURL);
        }
      } catch (error) {
        if (error.name !== 'AbortError') {
          console.error('ã‚·ã‚§ã‚¢ã‚¨ãƒ©ãƒ¼:', error);
          downloadImage(dataURL);
        }
      }
    }

    // === UIåˆ¶å¾¡ ===
    const colorPicker = document.getElementById('colorPicker');
    const hexInput = document.getElementById('hexInput');
    let currentShareImage = null;

    // ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã¨HEXå…¥åŠ›ã®åŒæœŸ
    colorPicker.addEventListener('input', (e) => {
      hexInput.value = e.target.value.toUpperCase();
    });

    hexInput.addEventListener('input', (e) => {
      const hex = e.target.value;
      if (/^#[0-9A-Fa-f]{6}$/.test(hex)) {
        colorPicker.value = hex;
      }
    });

    // ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
    function generateCard() {
      const hex = hexInput.value;
      const oklchData = { l: 0.61, c: 0.13, h: 340 };

      currentShareImage = generateGalleryShareCard(hex, oklchData);
      document.getElementById('sharePreview').src = currentShareImage;
      document.getElementById('previewContainer').classList.add('active');
    }

    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    function downloadCard() {
      if (!currentShareImage) return;
      const hex = hexInput.value.replace('#', '');
      downloadImage(currentShareImage, `my-color-${hex}.png`);
    }

    // ã‚·ã‚§ã‚¢
    function shareCard() {
      if (!currentShareImage) return;
      shareImageToSocial(currentShareImage, hexInput.value);
    }
  </script>
</body>
</html>
